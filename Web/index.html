<!DOCTYPE html>
<html lang="en" class="light-theme">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swift Architecture Diagram</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        :root {
    --bg-color: #ffffff;
    --text-color: #2c3e50;
    --primary-color: #3498db;
    --secondary-color: #7f8c8d;
    --border-color: #e1e5e9;
    --header-bg: rgba(255, 255, 255, 0.9);
    --sidebar-bg: rgba(248, 249, 250, 0.9);
    --button-bg: #ffffff;
    --button-hover: #f8f9fa;
    --input-bg: #ffffff;
    --legend-bg: rgba(255, 255, 255, 0.95);
    --type-item-bg: #ffffff;
    --type-item-hover: #f8f9fa;
    --type-item-selected: #3498db;
    --details-bg: #ffffff;
    --code-bg: #f8f9fa;
    --diagram-bg-start: #f8f9fa;
    --diagram-bg-end: #ffffff;
    
    --node-class: #e3f2fd;
    --node-struct: #fff3e0;
    --node-protocol: #f3e5f5;
    --node-enum: #e8f5e9;
    --node-actor: #fce4ec;
    --node-border: #90a4ae;
    --node-hover: #3498db;
    --node-selected: #e74c3c;
    
    --link-color: #7f8c8d;
    --link-hover: #3498db;
    
    --access-public: #e8f5e9;
    --access-internal: #fff3e0;
    --access-private: #ffebee;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    background-color: var(--bg-color);
    color: var(--text-color);
    height: 100vh;
    overflow: hidden;
    transition: background-color 0.3s ease, color 0.3s ease;
}

.container {
    height: 100vh;
    display: flex;
    flex-direction: column;
}

.header {
    padding: 1rem 2rem;
    border-bottom: 1px solid var(--border-color);
    background-color: var(--header-bg);
    backdrop-filter: blur(10px);
    z-index: 1000;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.header h1 {
    margin-bottom: 0.5rem;
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--primary-color);
}

.controls {
    display: flex;
    gap: 1rem;
    align-items: center;
    flex-wrap: wrap;
}

.controls button {
    padding: 0.5rem 1rem;
    border: 1px solid var(--border-color);
    background-color: var(--button-bg);
    color: var(--text-color);
    cursor: pointer;
    border-radius: 6px;
    font-size: 0.875rem;
    transition: all 0.2s ease;
}

.controls button:hover {
    background-color: var(--button-hover);
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

.controls button:active {
    transform: translateY(0);
}

.controls input[type="text"] {
    padding: 0.5rem 1rem;
    border: 1px solid var(--border-color);
    background-color: var(--input-bg);
    color: var(--text-color);
    border-radius: 6px;
    font-size: 0.875rem;
    min-width: 200px;
    transition: border-color 0.2s ease;
}

.controls input[type="text"]:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
}

.filter-group {
    display: flex;
    gap: 1rem;
    margin-left: 1rem;
}

.filter-group label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-size: 0.875rem;
}

.filter-group input[type="checkbox"] {
    width: 16px;
    height: 16px;
    accent-color: var(--primary-color);
}

.main-content {
    flex: 1;
    display: flex;
    overflow: hidden;
}

.sidebar {
    width: 320px;
    padding: 1.5rem;
    border-right: 1px solid var(--border-color);
    background-color: var(--sidebar-bg);
    overflow-y: auto;
    backdrop-filter: blur(10px);
}

.sidebar h3 {
    margin-bottom: 1rem;
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--primary-color);
}

.diagram-container {
    flex: 1;
    position: relative;
    background: linear-gradient(135deg, var(--diagram-bg-start), var(--diagram-bg-end));
    display: flex;
    flex-direction: column;
}

.diagram-search-bar {
    position: relative;
    padding: 1rem 2rem;
    background-color: var(--header-bg);
    border-bottom: 1px solid var(--border-color);
    backdrop-filter: blur(10px);
}

#diagram-search-input {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 1px solid var(--border-color);
    background-color: var(--input-bg);
    color: var(--text-color);
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

#diagram-search-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
}

.search-results-overlay {
    position: absolute;
    top: 100%;
    left: 2rem;
    right: 2rem;
    background-color: var(--sidebar-bg);
    border: 1px solid var(--border-color);
    border-top: none;
    border-radius: 0 0 8px 8px;
    max-height: 300px;
    overflow-y: auto;
    z-index: 1000;
    display: none;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    backdrop-filter: blur(10px);
}

.search-results-overlay.active {
    display: block;
}

.search-result-item {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid var(--border-color);
    cursor: pointer;
    transition: background-color 0.2s ease;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.search-result-item:hover {
    background-color: var(--button-hover);
}

.search-result-item:last-child {
    border-bottom: none;
}

.search-result-type {
    font-weight: 600;
    color: var(--primary-color);
}

.search-result-kind {
    background-color: var(--primary-color);
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.75rem;
    text-transform: uppercase;
    font-weight: 500;
}

.search-result-description {
    color: var(--secondary-color);
    font-size: 0.875rem;
}

#diagram {
    width: 100%;
    flex: 1;
}

.legend {
    position: absolute;
    bottom: 1.5rem;
    left: 1.5rem;
    background-color: var(--legend-bg);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 1rem;
    display: flex;
    gap: 1.5rem;
    z-index: 1000;
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
}

.legend-color {
    width: 18px;
    height: 18px;
    border-radius: 4px;
    border: 1px solid var(--border-color);
}

.class-color { background-color: var(--node-class); }
.struct-color { background-color: var(--node-struct); }
.protocol-color { background-color: var(--node-protocol); }
.enum-color { background-color: var(--node-enum); }
.actor-color { background-color: var(--node-actor); }

.node {
    stroke: var(--node-border);
    stroke-width: 2;
    cursor: pointer;
    transition: all 0.2s ease;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
}

.node:hover {
    stroke: var(--node-hover);
    stroke-width: 3;
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
}

.node.selected {
    stroke: var(--node-selected);
    stroke-width: 3;
    filter: drop-shadow(0 4px 12px rgba(231, 76, 60, 0.3));
}

.node.search-highlight {
    stroke: var(--primary-color);
    stroke-width: 3;
    filter: drop-shadow(0 0 8px var(--primary-color)) !important;
}

.node.focused-node {
    stroke: #ff6b6b;
    stroke-width: 4;
    filter: drop-shadow(0 0 12px #ff6b6b) !important;
}

.node-text {
    font-size: 12px;
    font-weight: 500;
    text-anchor: middle;
    dominant-baseline: middle;
    fill: var(--text-color);
    pointer-events: none;
}

.node-title {
    font-size: 14px;
    font-weight: 600;
}

.node-type {
    font-size: 10px;
    font-weight: 400;
    opacity: 0.8;
}

.node-details {
    font-size: 9px;
    font-weight: 400;
    opacity: 0.7;
}

.link {
    stroke: var(--link-color);
    stroke-width: 2;
    fill: none;
    marker-end: url(#arrowhead);
    transition: all 0.2s ease;
}

.link:hover {
    stroke-width: 3;
    stroke: var(--link-hover);
}

.link.inheritance {
    stroke-dasharray: none;
    stroke-width: 2.5;
}

.link.conformance {
    stroke-dasharray: 5,5;
}

.link.composition {
    stroke-width: 3;
}

.link.dependency {
    stroke-dasharray: 3,3;
    opacity: 0.7;
}

.type-item {
    padding: 0.75rem;
    margin-bottom: 0.5rem;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
    background-color: var(--type-item-bg);
}

.type-item:hover {
    background-color: var(--type-item-hover);
    transform: translateX(2px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.type-item.selected {
    background-color: var(--type-item-selected);
    color: white;
    border-color: var(--primary-color);
}

.type-item-name {
    font-weight: 600;
    margin-bottom: 0.25rem;
}

.type-item-kind {
    font-size: 0.75rem;
    opacity: 0.8;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.type-details {
    margin-top: 1.5rem;
    padding: 1rem;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background-color: var(--details-bg);
    max-height: 400px;
    overflow-y: auto;
}

.type-details h4 {
    margin-bottom: 0.75rem;
    font-size: 1.1rem;
    color: var(--primary-color);
}

.type-details h5 {
    margin-top: 1rem;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
    color: var(--secondary-color);
}

.type-details ul {
    list-style: none;
    margin-left: 0;
}

.type-details li {
    margin-bottom: 0.375rem;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    background-color: var(--code-bg);
    font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
    font-size: 0.8rem;
}

.access-level {
    display: inline-block;
    padding: 0.125rem 0.375rem;
    border-radius: 3px;
    font-size: 0.7rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 0.5rem;
}

.access-level.public { background-color: var(--access-public); }
.access-level.internal { background-color: var(--access-internal); }
.access-level.private { background-color: var(--access-private); }

@media (max-width: 768px) {
    .sidebar {
        width: 280px;
    }
    
    .controls {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
    }
    
    .filter-group {
        margin-left: 0;
    }
    
    .legend {
        flex-direction: column;
        gap: 0.5rem;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Swift Architecture Diagram</h1>
            <div class="controls">
                <button id="reset-zoom">Reset Zoom</button>
                <button id="toggle-theme">Toggle Theme</button>
                <input type="text" id="search-input" placeholder="Search types...">
                <div class="filter-group">
                    <label><input type="checkbox" id="show-properties" checked> Properties</label>
                    <label><input type="checkbox" id="show-methods" checked> Methods</label>
                    <label><input type="checkbox" id="show-initializers" checked> Initializers</label>
                    <label><input type="checkbox" id="show-private"> Private</label>
                </div>
            </div>
        </header>
        
        <div class="main-content">
            <div class="sidebar">
                <h3>Type Explorer</h3>
                <div id="type-list"></div>
                <div id="type-details"></div>
            </div>
            
            <div class="diagram-container">
                <div class="diagram-search-bar">
                    <input type="text" id="diagram-search-input" placeholder="Search types across the entire diagram...">
                    <div id="search-results" class="search-results-overlay"></div>
                </div>
                <svg id="diagram"></svg>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color class-color"></div>
                <span>Class</span>
            </div>
            <div class="legend-item">
                <div class="legend-color struct-color"></div>
                <span>Struct</span>
            </div>
            <div class="legend-item">
                <div class="legend-color protocol-color"></div>
                <span>Protocol</span>
            </div>
            <div class="legend-item">
                <div class="legend-color enum-color"></div>
                <span>Enum</span>
            </div>
            <div class="legend-item">
                <div class="legend-color actor-color"></div>
                <span>Actor</span>
            </div>
        </div>
    </div>
    
    <script>
        const graphData = {
  "nodes" : [
    {
      "type" : {
        "location" : {
          "file" : "<external>",
          "column" : 0,
          "line" : 0
        },
        "accessLevel" : "public",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "associatedTypes" : [

        ],
        "conformedProtocols" : [

        ],
        "kind" : "struct",
        "typeAliases" : [

        ],
        "initializers" : [

        ],
        "properties" : [

        ],
        "protocolRequirements" : [

        ],
        "nestedTypes" : [

        ],
        "subscripts" : [

        ],
        "inheritedTypes" : [

        ],
        "isPhantom" : true,
        "methods" : [

        ],
        "attributes" : [

        ],
        "name" : "[Double]"
      },
      "relationships" : [

      ]
    },
    {
      "type" : {
        "location" : {
          "file" : "test_extension_comprehensive.swift",
          "column" : 1,
          "line" : 34
        },
        "accessLevel" : "internal",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "kind" : "class",
        "associatedTypes" : [

        ],
        "properties" : [
          {
            "attributes" : [

            ],
            "hasDidSet" : false,
            "isUnowned" : false,
            "accessLevel" : "internal",
            "isComputed" : false,
            "isWeak" : false,
            "isLazy" : false,
            "isStatic" : false,
            "hasGetter" : true,
            "isLet" : true,
            "hasSetter" : false,
            "typeName" : "String",
            "isFromExtension" : false,
            "hasWillSet" : false,
            "name" : "id"
          },
          {
            "attributes" : [

            ],
            "hasDidSet" : false,
            "isUnowned" : false,
            "accessLevel" : "internal",
            "isComputed" : false,
            "isWeak" : false,
            "isLazy" : false,
            "isStatic" : false,
            "hasGetter" : true,
            "isLet" : true,
            "hasSetter" : false,
            "typeName" : "String",
            "isFromExtension" : false,
            "hasWillSet" : false,
            "name" : "name"
          },
          {
            "attributes" : [

            ],
            "hasDidSet" : false,
            "isUnowned" : false,
            "accessLevel" : "internal",
            "isComputed" : false,
            "isWeak" : false,
            "isLazy" : false,
            "isStatic" : false,
            "hasGetter" : true,
            "isLet" : true,
            "hasSetter" : false,
            "typeName" : "Double",
            "isFromExtension" : false,
            "hasWillSet" : false,
            "name" : "price"
          },
          {
            "attributes" : [

            ],
            "hasDidSet" : false,
            "isUnowned" : false,
            "accessLevel" : "internal",
            "isComputed" : true,
            "isWeak" : false,
            "isLazy" : false,
            "isStatic" : false,
            "hasGetter" : true,
            "isLet" : false,
            "hasSetter" : false,
            "typeName" : "String",
            "isFromExtension" : true,
            "hasWillSet" : false,
            "name" : "description"
          }
        ],
        "typeAliases" : [

        ],
        "initializers" : [
          {
            "isRequired" : false,
            "isFailable" : false,
            "parameters" : [
              {
                "typeName" : "String",
                "typeAttributes" : [

                ],
                "attributes" : [

                ],
                "name" : "id",
                "label" : "id",
                "isVariadic" : false,
                "isInout" : false
              },
              {
                "typeName" : "String",
                "typeAttributes" : [

                ],
                "attributes" : [

                ],
                "name" : "name",
                "label" : "name",
                "isVariadic" : false,
                "isInout" : false
              },
              {
                "typeName" : "Double",
                "typeAttributes" : [

                ],
                "attributes" : [

                ],
                "name" : "price",
                "label" : "price",
                "isVariadic" : false,
                "isInout" : false
              }
            ],
            "accessLevel" : "internal",
            "isAsync" : false,
            "attributes" : [

            ],
            "genericParameters" : [

            ],
            "throws" : false,
            "isConvenience" : false,
            "genericConstraints" : [

            ],
            "isFromExtension" : false
          }
        ],
        "conformedProtocols" : [
          "Hashable",
          "Equatable",
          "CustomStringConvertible"
        ],
        "protocolRequirements" : [

        ],
        "nestedTypes" : [

        ],
        "subscripts" : [

        ],
        "inheritedTypes" : [

        ],
        "isPhantom" : false,
        "methods" : [
          {
            "isFinal" : false,
            "accessLevel" : "internal",
            "isNonMutating" : false,
            "parameters" : [
              {
                "isVariadic" : false,
                "name" : "lhs",
                "isInout" : false,
                "typeName" : "Product",
                "label" : "lhs",
                "attributes" : [

                ],
                "typeAttributes" : [

                ]
              },
              {
                "name" : "rhs",
                "label" : "rhs",
                "typeName" : "Product",
                "isInout" : false,
                "typeAttributes" : [

                ],
                "isVariadic" : false,
                "attributes" : [

                ]
              }
            ],
            "genericConstraints" : [

            ],
            "isMutating" : false,
            "genericParameters" : [

            ],
            "isOptional" : false,
            "throws" : false,
            "isAsync" : false,
            "isOverride" : false,
            "isStatic" : true,
            "isClass" : false,
            "returnType" : "Bool",
            "rethrows" : false,
            "isFromExtension" : true,
            "attributes" : [

            ],
            "name" : "=="
          },
          {
            "isFinal" : false,
            "accessLevel" : "internal",
            "isNonMutating" : false,
            "parameters" : [
              {
                "name" : "hasher",
                "label" : "into",
                "typeName" : "inout Hasher",
                "isInout" : true,
                "typeAttributes" : [

                ],
                "isVariadic" : false,
                "attributes" : [

                ]
              }
            ],
            "genericConstraints" : [

            ],
            "isMutating" : false,
            "genericParameters" : [

            ],
            "isOptional" : false,
            "throws" : false,
            "isAsync" : false,
            "isOverride" : false,
            "isStatic" : false,
            "isClass" : false,
            "rethrows" : false,
            "isFromExtension" : true,
            "attributes" : [

            ],
            "name" : "hash"
          }
        ],
        "attributes" : [

        ],
        "name" : "Product"
      },
      "relationships" : [
        {
          "from" : "Product",
          "to" : "Product",
          "kind" : "uses",
          "details" : "parameter in: =="
        },
        {
          "from" : "Product",
          "to" : "Hashable",
          "kind" : "implements",
          "details" : "implements protocol"
        },
        {
          "from" : "Product",
          "to" : "CustomStringConvertible",
          "kind" : "conforms"
        },
        {
          "from" : "Product",
          "to" : "inout Hasher",
          "kind" : "uses",
          "details" : "parameter in: hash"
        },
        {
          "from" : "Product",
          "to" : "Equatable",
          "kind" : "conforms"
        },
        {
          "from" : "Product",
          "to" : "Equatable",
          "kind" : "implements",
          "details" : "implements protocol"
        },
        {
          "from" : "Product",
          "to" : "Hashable",
          "kind" : "conforms"
        },
        {
          "from" : "Product",
          "to" : "CustomStringConvertible",
          "kind" : "implements",
          "details" : "implements protocol"
        }
      ]
    },
    {
      "type" : {
        "location" : {
          "file" : "<external>",
          "column" : 0,
          "line" : 0
        },
        "accessLevel" : "public",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "associatedTypes" : [

        ],
        "kind" : "class",
        "conformedProtocols" : [

        ],
        "typeAliases" : [

        ],
        "properties" : [

        ],
        "initializers" : [

        ],
        "protocolRequirements" : [

        ],
        "subscripts" : [

        ],
        "nestedTypes" : [

        ],
        "inheritedTypes" : [

        ],
        "isPhantom" : true,
        "methods" : [

        ],
        "attributes" : [

        ],
        "name" : "T"
      },
      "relationships" : [

      ]
    },
    {
      "type" : {
        "location" : {
          "column" : 0,
          "line" : 0,
          "file" : "<external>"
        },
        "accessLevel" : "public",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "associatedTypes" : [

        ],
        "conformedProtocols" : [

        ],
        "kind" : "struct",
        "properties" : [

        ],
        "initializers" : [

        ],
        "typeAliases" : [

        ],
        "protocolRequirements" : [

        ],
        "subscripts" : [

        ],
        "nestedTypes" : [

        ],
        "inheritedTypes" : [

        ],
        "isPhantom" : true,
        "methods" : [

        ],
        "attributes" : [

        ],
        "name" : "inout Hasher"
      },
      "relationships" : [

      ]
    },
    {
      "type" : {
        "location" : {
          "file" : "test_extension_comprehensive.swift",
          "line" : 7,
          "column" : 1
        },
        "accessLevel" : "internal",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "associatedTypes" : [

        ],
        "kind" : "class",
        "properties" : [
          {
            "attributes" : [

            ],
            "hasDidSet" : false,
            "isUnowned" : false,
            "accessLevel" : "internal",
            "isComputed" : false,
            "isWeak" : false,
            "isLazy" : false,
            "isStatic" : false,
            "hasGetter" : true,
            "isLet" : true,
            "hasSetter" : false,
            "typeName" : "String",
            "isFromExtension" : false,
            "hasWillSet" : false,
            "name" : "id"
          },
          {
            "attributes" : [

            ],
            "hasDidSet" : false,
            "isUnowned" : false,
            "accessLevel" : "internal",
            "isComputed" : false,
            "isWeak" : false,
            "isLazy" : false,
            "isStatic" : false,
            "hasGetter" : true,
            "isLet" : false,
            "hasSetter" : false,
            "typeName" : "String",
            "isFromExtension" : false,
            "hasWillSet" : false,
            "name" : "name"
          },
          {
            "attributes" : [

            ],
            "hasDidSet" : false,
            "isUnowned" : false,
            "accessLevel" : "internal",
            "isComputed" : true,
            "isWeak" : false,
            "isLazy" : false,
            "isStatic" : false,
            "hasGetter" : true,
            "isLet" : false,
            "hasSetter" : false,
            "typeName" : "String",
            "isFromExtension" : true,
            "hasWillSet" : false,
            "name" : "displayName"
          }
        ],
        "conformedProtocols" : [

        ],
        "initializers" : [
          {
            "isFailable" : false,
            "throws" : false,
            "attributes" : [

            ],
            "accessLevel" : "internal",
            "isRequired" : false,
            "isConvenience" : false,
            "isAsync" : false,
            "genericParameters" : [

            ],
            "isFromExtension" : false,
            "parameters" : [
              {
                "isVariadic" : false,
                "isInout" : false,
                "attributes" : [

                ],
                "typeAttributes" : [

                ],
                "label" : "id",
                "typeName" : "String",
                "name" : "id"
              },
              {
                "name" : "name",
                "isVariadic" : false,
                "attributes" : [

                ],
                "typeAttributes" : [

                ],
                "isInout" : false,
                "label" : "name",
                "typeName" : "String"
              }
            ],
            "genericConstraints" : [

            ]
          }
        ],
        "typeAliases" : [

        ],
        "protocolRequirements" : [

        ],
        "subscripts" : [

        ],
        "nestedTypes" : [

        ],
        "inheritedTypes" : [

        ],
        "isPhantom" : false,
        "methods" : [
          {
            "isFinal" : false,
            "isNonMutating" : false,
            "accessLevel" : "internal",
            "parameters" : [

            ],
            "genericConstraints" : [

            ],
            "isMutating" : false,
            "genericParameters" : [

            ],
            "throws" : false,
            "isOptional" : false,
            "isAsync" : false,
            "isOverride" : false,
            "isClass" : false,
            "isStatic" : false,
            "returnType" : "String",
            "rethrows" : false,
            "isFromExtension" : true,
            "attributes" : [

            ],
            "name" : "greet"
          },
          {
            "isFinal" : false,
            "isNonMutating" : false,
            "accessLevel" : "internal",
            "parameters" : [

            ],
            "genericConstraints" : [

            ],
            "isMutating" : false,
            "genericParameters" : [

            ],
            "throws" : false,
            "isOptional" : false,
            "isAsync" : false,
            "isOverride" : false,
            "isClass" : false,
            "isStatic" : true,
            "returnType" : "BasicUser",
            "rethrows" : false,
            "isFromExtension" : true,
            "attributes" : [

            ],
            "name" : "createDefault"
          }
        ],
        "attributes" : [

        ],
        "name" : "BasicUser"
      },
      "relationships" : [
        {
          "from" : "BasicUser",
          "to" : "BasicUser",
          "details" : "returns from: createDefault",
          "kind" : "uses"
        }
      ]
    },
    {
      "type" : {
        "location" : {
          "file" : "test_extension_comprehensive.swift",
          "line" : 239,
          "column" : 1
        },
        "accessLevel" : "internal",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "kind" : "class",
        "associatedTypes" : [

        ],
        "properties" : [
          {
            "attributes" : [

            ],
            "hasDidSet" : false,
            "isUnowned" : false,
            "defaultValue" : "\"\"",
            "accessLevel" : "internal",
            "isComputed" : false,
            "isWeak" : false,
            "isLazy" : false,
            "isStatic" : false,
            "hasGetter" : true,
            "isLet" : false,
            "hasSetter" : false,
            "typeName" : "String",
            "isFromExtension" : false,
            "hasWillSet" : false,
            "name" : "detailData"
          }
        ],
        "typeAliases" : [

        ],
        "initializers" : [

        ],
        "conformedProtocols" : [

        ],
        "protocolRequirements" : [

        ],
        "subscripts" : [

        ],
        "nestedTypes" : [

        ],
        "inheritedTypes" : [
          "BaseViewController"
        ],
        "isPhantom" : false,
        "methods" : [
          {
            "isFinal" : false,
            "isNonMutating" : false,
            "accessLevel" : "internal",
            "parameters" : [

            ],
            "genericConstraints" : [

            ],
            "isMutating" : false,
            "genericParameters" : [

            ],
            "throws" : false,
            "isOptional" : false,
            "isAsync" : false,
            "isOverride" : false,
            "isClass" : false,
            "isStatic" : false,
            "rethrows" : false,
            "isFromExtension" : true,
            "attributes" : [

            ],
            "name" : "loadDetailData"
          }
        ],
        "attributes" : [

        ],
        "name" : "DetailViewController"
      },
      "relationships" : [
        {
          "from" : "DetailViewController",
          "kind" : "inherits",
          "to" : "BaseViewController"
        }
      ]
    },
    {
      "type" : {
        "location" : {
          "file" : "test_extension_comprehensive.swift",
          "line" : 92,
          "column" : 5
        },
        "accessLevel" : "internal",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "kind" : "enum",
        "conformedProtocols" : [

        ],
        "properties" : [

        ],
        "typeAliases" : [

        ],
        "initializers" : [

        ],
        "associatedTypes" : [

        ],
        "protocolRequirements" : [

        ],
        "subscripts" : [

        ],
        "nestedTypes" : [

        ],
        "inheritedTypes" : [
          "Error"
        ],
        "isPhantom" : false,
        "methods" : [

        ],
        "attributes" : [

        ],
        "name" : "CacheError"
      },
      "relationships" : [
        {
          "kind" : "inherits",
          "to" : "Error",
          "from" : "CacheError"
        }
      ]
    },
    {
      "type" : {
        "location" : {
          "file" : "<external>",
          "line" : 0,
          "column" : 0
        },
        "accessLevel" : "public",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "kind" : "struct",
        "conformedProtocols" : [

        ],
        "properties" : [

        ],
        "typeAliases" : [

        ],
        "initializers" : [

        ],
        "associatedTypes" : [

        ],
        "protocolRequirements" : [

        ],
        "subscripts" : [

        ],
        "nestedTypes" : [

        ],
        "inheritedTypes" : [

        ],
        "isPhantom" : true,
        "moduleName" : "Swift",
        "methods" : [

        ],
        "attributes" : [

        ],
        "name" : "Array"
      },
      "relationships" : [

      ]
    },
    {
      "type" : {
        "location" : {
          "file" : "<external>",
          "line" : 0,
          "column" : 0
        },
        "accessLevel" : "public",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "kind" : "protocol",
        "conformedProtocols" : [

        ],
        "properties" : [

        ],
        "typeAliases" : [

        ],
        "initializers" : [

        ],
        "associatedTypes" : [

        ],
        "protocolRequirements" : [

        ],
        "subscripts" : [

        ],
        "nestedTypes" : [

        ],
        "inheritedTypes" : [

        ],
        "isPhantom" : true,
        "methods" : [

        ],
        "moduleName" : "Swift",
        "attributes" : [

        ],
        "name" : "Codable"
      },
      "relationships" : [

      ]
    },
    {
      "type" : {
        "location" : {
          "line" : 65,
          "column" : 1,
          "file" : "test_extension_comprehensive.swift"
        },
        "accessLevel" : "internal",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "associatedTypes" : [

        ],
        "kind" : "class",
        "properties" : [
          {
            "attributes" : [

            ],
            "hasDidSet" : false,
            "isUnowned" : false,
            "accessLevel" : "internal",
            "isComputed" : false,
            "isWeak" : false,
            "isLazy" : false,
            "isStatic" : false,
            "hasGetter" : true,
            "isLet" : true,
            "hasSetter" : false,
            "typeName" : "String",
            "isFromExtension" : false,
            "hasWillSet" : false,
            "name" : "id"
          },
          {
            "attributes" : [

            ],
            "hasDidSet" : false,
            "isUnowned" : false,
            "defaultValue" : "[]",
            "accessLevel" : "internal",
            "isComputed" : false,
            "isWeak" : false,
            "isLazy" : false,
            "isStatic" : false,
            "hasGetter" : true,
            "isLet" : false,
            "hasSetter" : false,
            "typeName" : "[Product]",
            "isFromExtension" : false,
            "hasWillSet" : false,
            "name" : "items"
          },
          {
            "attributes" : [

            ],
            "hasDidSet" : false,
            "isUnowned" : false,
            "accessLevel" : "internal",
            "isComputed" : true,
            "isWeak" : false,
            "isLazy" : false,
            "isStatic" : false,
            "hasGetter" : true,
            "isLet" : false,
            "hasSetter" : false,
            "typeName" : "String",
            "isFromExtension" : true,
            "hasWillSet" : false,
            "name" : "description"
          }
        ],
        "typeAliases" : [

        ],
        "initializers" : [
          {
            "isConvenience" : false,
            "genericConstraints" : [

            ],
            "isAsync" : false,
            "throws" : false,
            "isFailable" : false,
            "accessLevel" : "internal",
            "attributes" : [

            ],
            "parameters" : [
              {
                "attributes" : [

                ],
                "name" : "id",
                "typeName" : "String",
                "isInout" : false,
                "typeAttributes" : [

                ],
                "isVariadic" : false,
                "label" : "id"
              }
            ],
            "isRequired" : false,
            "genericParameters" : [

            ],
            "isFromExtension" : false
          }
        ],
        "conformedProtocols" : [
          "CustomStringConvertible",
          "Codable"
        ],
        "protocolRequirements" : [

        ],
        "subscripts" : [

        ],
        "nestedTypes" : [

        ],
        "inheritedTypes" : [

        ],
        "isPhantom" : false,
        "methods" : [

        ],
        "attributes" : [

        ],
        "name" : "Order"
      },
      "relationships" : [
        {
          "details" : "implements protocol",
          "to" : "CustomStringConvertible",
          "kind" : "implements",
          "from" : "Order"
        },
        {
          "details" : "implements protocol",
          "to" : "Codable",
          "kind" : "implements",
          "from" : "Order"
        },
        {
          "details" : "property items contains Product",
          "to" : "Product",
          "kind" : "element_type",
          "from" : "Order"
        },
        {
          "to" : "Codable",
          "kind" : "conforms",
          "from" : "Order"
        },
        {
          "to" : "CustomStringConvertible",
          "kind" : "conforms",
          "from" : "Order"
        },
        {
          "details" : "property items uses collection Array",
          "to" : "Array",
          "kind" : "uses",
          "from" : "Order"
        },
        {
          "details" : "property: items",
          "to" : "Product",
          "kind" : "contains",
          "from" : "Order"
        }
      ]
    },
    {
      "type" : {
        "location" : {
          "file" : "<external>",
          "line" : 0,
          "column" : 0
        },
        "accessLevel" : "public",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "associatedTypes" : [

        ],
        "conformedProtocols" : [

        ],
        "properties" : [

        ],
        "typeAliases" : [

        ],
        "initializers" : [

        ],
        "kind" : "class",
        "protocolRequirements" : [

        ],
        "subscripts" : [

        ],
        "nestedTypes" : [

        ],
        "inheritedTypes" : [

        ],
        "isPhantom" : true,
        "methods" : [

        ],
        "attributes" : [

        ],
        "name" : "Error"
      },
      "relationships" : [

      ]
    },
    {
      "type" : {
        "location" : {
          "column" : 0,
          "line" : 0,
          "file" : "<external>"
        },
        "accessLevel" : "public",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "kind" : "protocol",
        "conformedProtocols" : [

        ],
        "properties" : [

        ],
        "typeAliases" : [

        ],
        "initializers" : [

        ],
        "associatedTypes" : [

        ],
        "protocolRequirements" : [

        ],
        "subscripts" : [

        ],
        "nestedTypes" : [

        ],
        "inheritedTypes" : [

        ],
        "isPhantom" : true,
        "methods" : [

        ],
        "moduleName" : "Swift",
        "attributes" : [

        ],
        "name" : "CustomStringConvertible"
      },
      "relationships" : [

      ]
    },
    {
      "type" : {
        "location" : {
          "column" : 5,
          "line" : 97,
          "file" : "test_extension_comprehensive.swift"
        },
        "accessLevel" : "internal",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "associatedTypes" : [

        ],
        "conformedProtocols" : [

        ],
        "properties" : [
          {
            "attributes" : [

            ],
            "hasDidSet" : false,
            "isUnowned" : false,
            "accessLevel" : "internal",
            "isComputed" : false,
            "isWeak" : false,
            "isLazy" : false,
            "isStatic" : false,
            "hasGetter" : true,
            "isLet" : true,
            "hasSetter" : false,
            "typeName" : "String",
            "isFromExtension" : false,
            "hasWillSet" : false,
            "name" : "value"
          }
        ],
        "kind" : "struct",
        "initializers" : [

        ],
        "typeAliases" : [

        ],
        "protocolRequirements" : [

        ],
        "subscripts" : [

        ],
        "nestedTypes" : [

        ],
        "inheritedTypes" : [

        ],
        "isPhantom" : false,
        "methods" : [

        ],
        "attributes" : [

        ],
        "name" : "CacheKey"
      },
      "relationships" : [

      ]
    },
    {
      "type" : {
        "location" : {
          "line" : 0,
          "file" : "<external>",
          "column" : 0
        },
        "accessLevel" : "public",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "associatedTypes" : [

        ],
        "conformedProtocols" : [

        ],
        "kind" : "class",
        "typeAliases" : [

        ],
        "initializers" : [

        ],
        "properties" : [

        ],
        "protocolRequirements" : [

        ],
        "subscripts" : [

        ],
        "nestedTypes" : [

        ],
        "inheritedTypes" : [

        ],
        "isPhantom" : true,
        "methods" : [

        ],
        "attributes" : [

        ],
        "name" : "String: Any"
      },
      "relationships" : [

      ]
    },
    {
      "type" : {
        "location" : {
          "file" : "<external>",
          "column" : 0,
          "line" : 0
        },
        "accessLevel" : "public",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "associatedTypes" : [

        ],
        "conformedProtocols" : [

        ],
        "properties" : [

        ],
        "typeAliases" : [

        ],
        "initializers" : [

        ],
        "kind" : "class",
        "protocolRequirements" : [

        ],
        "nestedTypes" : [

        ],
        "subscripts" : [

        ],
        "inheritedTypes" : [

        ],
        "isPhantom" : true,
        "methods" : [

        ],
        "attributes" : [

        ],
        "name" : "Type"
      },
      "relationships" : [

      ]
    },
    {
      "type" : {
        "location" : {
          "line" : 87,
          "column" : 1,
          "file" : "test_extension_comprehensive.swift"
        },
        "accessLevel" : "internal",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "kind" : "class",
        "conformedProtocols" : [

        ],
        "properties" : [
          {
            "attributes" : [

            ],
            "hasDidSet" : false,
            "isUnowned" : false,
            "defaultValue" : "[:]",
            "accessLevel" : "private",
            "isComputed" : false,
            "isWeak" : false,
            "isLazy" : false,
            "isStatic" : false,
            "hasGetter" : true,
            "isLet" : false,
            "hasSetter" : false,
            "typeName" : "[String: Any]",
            "isFromExtension" : false,
            "hasWillSet" : false,
            "name" : "cache"
          }
        ],
        "typeAliases" : [

        ],
        "associatedTypes" : [

        ],
        "initializers" : [

        ],
        "protocolRequirements" : [

        ],
        "nestedTypes" : [

        ],
        "subscripts" : [

        ],
        "inheritedTypes" : [

        ],
        "isPhantom" : false,
        "methods" : [
          {
            "isFinal" : false,
            "isNonMutating" : false,
            "accessLevel" : "internal",
            "parameters" : [
              {
                "typeAttributes" : [

                ],
                "name" : "value",
                "isVariadic" : false,
                "typeName" : "T",
                "isInout" : false,
                "attributes" : [

                ]
              },
              {
                "attributes" : [

                ],
                "label" : "for",
                "isVariadic" : false,
                "name" : "key",
                "isInout" : false,
                "typeAttributes" : [

                ],
                "typeName" : "CacheKey"
              }
            ],
            "genericConstraints" : [

            ],
            "isMutating" : false,
            "genericParameters" : [

            ],
            "isOptional" : false,
            "throws" : false,
            "isAsync" : false,
            "isOverride" : false,
            "isClass" : false,
            "isStatic" : false,
            "rethrows" : false,
            "isFromExtension" : true,
            "attributes" : [

            ],
            "name" : "store"
          },
          {
            "isFinal" : false,
            "accessLevel" : "internal",
            "isNonMutating" : false,
            "parameters" : [
              {
                "name" : "type",
                "typeName" : "T.Type",
                "isInout" : false,
                "attributes" : [

                ],
                "isVariadic" : false,
                "typeAttributes" : [

                ]
              },
              {
                "typeAttributes" : [

                ],
                "label" : "for",
                "name" : "key",
                "isInout" : false,
                "attributes" : [

                ],
                "typeName" : "CacheKey",
                "isVariadic" : false
              }
            ],
            "genericConstraints" : [

            ],
            "isMutating" : false,
            "genericParameters" : [

            ],
            "isOptional" : false,
            "throws" : true,
            "isAsync" : false,
            "isOverride" : false,
            "isStatic" : false,
            "isClass" : false,
            "returnType" : "T",
            "rethrows" : false,
            "isFromExtension" : true,
            "attributes" : [

            ],
            "name" : "retrieve"
          }
        ],
        "attributes" : [

        ],
        "name" : "DataManager"
      },
      "relationships" : [
        {
          "kind" : "uses",
          "details" : "property cache uses collection Dictionary",
          "from" : "DataManager",
          "to" : "Dictionary"
        },
        {
          "from" : "DataManager",
          "to" : "T",
          "details" : "parameter in: store",
          "kind" : "uses"
        },
        {
          "from" : "DataManager",
          "to" : "Type",
          "details" : "parameter in: retrieve",
          "kind" : "uses"
        },
        {
          "from" : "DataManager",
          "to" : "CacheKey",
          "details" : "parameter in: retrieve",
          "kind" : "uses"
        },
        {
          "from" : "DataManager",
          "to" : "String: Any",
          "details" : "property: cache",
          "kind" : "contains"
        },
        {
          "from" : "DataManager",
          "to" : "CacheKey",
          "details" : "parameter in: store",
          "kind" : "uses"
        },
        {
          "from" : "DataManager",
          "to" : "T",
          "details" : "returns from: retrieve",
          "kind" : "uses"
        }
      ]
    },
    {
      "type" : {
        "location" : {
          "column" : 0,
          "line" : 0,
          "file" : "<external>"
        },
        "accessLevel" : "public",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "kind" : "struct",
        "conformedProtocols" : [

        ],
        "properties" : [
          {
            "attributes" : [

            ],
            "hasDidSet" : false,
            "isUnowned" : false,
            "accessLevel" : "internal",
            "isComputed" : true,
            "isWeak" : false,
            "isLazy" : false,
            "isStatic" : false,
            "hasGetter" : true,
            "isLet" : false,
            "hasSetter" : false,
            "typeName" : "Bool",
            "isFromExtension" : true,
            "hasWillSet" : false,
            "name" : "isEmail"
          }
        ],
        "typeAliases" : [

        ],
        "initializers" : [

        ],
        "associatedTypes" : [

        ],
        "protocolRequirements" : [

        ],
        "subscripts" : [

        ],
        "nestedTypes" : [

        ],
        "inheritedTypes" : [

        ],
        "isPhantom" : false,
        "moduleName" : "Swift",
        "methods" : [
          {
            "isFinal" : false,
            "accessLevel" : "internal",
            "isNonMutating" : false,
            "parameters" : [

            ],
            "genericConstraints" : [

            ],
            "isMutating" : false,
            "genericParameters" : [

            ],
            "throws" : false,
            "isOptional" : false,
            "isAsync" : false,
            "isOverride" : false,
            "isStatic" : false,
            "isClass" : false,
            "returnType" : "String",
            "rethrows" : false,
            "isFromExtension" : true,
            "attributes" : [

            ],
            "name" : "trimmed"
          }
        ],
        "attributes" : [

        ],
        "name" : "String"
      },
      "relationships" : [

      ]
    },
    {
      "type" : {
        "location" : {
          "line" : 81,
          "column" : 5,
          "file" : "test_extension_comprehensive.swift"
        },
        "accessLevel" : "internal",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "associatedTypes" : [

        ],
        "conformedProtocols" : [

        ],
        "properties" : [

        ],
        "typeAliases" : [

        ],
        "kind" : "enum",
        "initializers" : [

        ],
        "protocolRequirements" : [

        ],
        "nestedTypes" : [

        ],
        "subscripts" : [

        ],
        "inheritedTypes" : [
          "CodingKey",
          "String"
        ],
        "isPhantom" : false,
        "methods" : [

        ],
        "attributes" : [

        ],
        "name" : "CodingKeys"
      },
      "relationships" : [
        {
          "from" : "CodingKeys",
          "to" : "String",
          "kind" : "inherits"
        },
        {
          "from" : "CodingKeys",
          "to" : "CodingKey",
          "kind" : "inherits"
        }
      ]
    },
    {
      "type" : {
        "location" : {
          "file" : "test_extension_comprehensive.swift",
          "line" : 225,
          "column" : 1
        },
        "accessLevel" : "internal",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "kind" : "class",
        "conformedProtocols" : [

        ],
        "properties" : [
          {
            "attributes" : [

            ],
            "hasDidSet" : false,
            "isUnowned" : false,
            "defaultValue" : "\"\"",
            "accessLevel" : "internal",
            "isComputed" : false,
            "isWeak" : false,
            "isLazy" : false,
            "isStatic" : false,
            "hasGetter" : true,
            "isLet" : false,
            "hasSetter" : false,
            "typeName" : "String",
            "isFromExtension" : false,
            "hasWillSet" : false,
            "name" : "customProperty"
          },
          {
            "attributes" : [

            ],
            "hasDidSet" : false,
            "isUnowned" : false,
            "accessLevel" : "internal",
            "isComputed" : true,
            "isWeak" : false,
            "isLazy" : false,
            "isStatic" : false,
            "hasGetter" : true,
            "isLet" : false,
            "hasSetter" : false,
            "typeName" : "Bool",
            "isFromExtension" : true,
            "hasWillSet" : false,
            "name" : "isModalPresentation"
          }
        ],
        "typeAliases" : [

        ],
        "initializers" : [

        ],
        "associatedTypes" : [

        ],
        "protocolRequirements" : [

        ],
        "nestedTypes" : [

        ],
        "subscripts" : [

        ],
        "inheritedTypes" : [
          "UIViewController"
        ],
        "isPhantom" : false,
        "methods" : [
          {
            "isFinal" : false,
            "accessLevel" : "internal",
            "isNonMutating" : false,
            "parameters" : [

            ],
            "genericConstraints" : [

            ],
            "isMutating" : false,
            "genericParameters" : [

            ],
            "isOptional" : false,
            "throws" : false,
            "isAsync" : false,
            "isOverride" : false,
            "isStatic" : false,
            "isClass" : false,
            "rethrows" : false,
            "isFromExtension" : true,
            "attributes" : [

            ],
            "name" : "setupUI"
          }
        ],
        "attributes" : [

        ],
        "name" : "BaseViewController"
      },
      "relationships" : [
        {
          "to" : "UIViewController",
          "from" : "BaseViewController",
          "kind" : "inherits"
        }
      ]
    },
    {
      "type" : {
        "location" : {
          "file" : "<external>",
          "line" : 0,
          "column" : 0
        },
        "accessLevel" : "public",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "kind" : "protocol",
        "conformedProtocols" : [

        ],
        "properties" : [

        ],
        "typeAliases" : [

        ],
        "initializers" : [

        ],
        "associatedTypes" : [

        ],
        "protocolRequirements" : [

        ],
        "subscripts" : [

        ],
        "nestedTypes" : [

        ],
        "inheritedTypes" : [

        ],
        "isPhantom" : true,
        "methods" : [

        ],
        "moduleName" : "Swift",
        "attributes" : [

        ],
        "name" : "Equatable"
      },
      "relationships" : [

      ]
    },
    {
      "type" : {
        "location" : {
          "file" : "test_extension_comprehensive.swift",
          "column" : 1,
          "line" : 117
        },
        "accessLevel" : "internal",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "associatedTypes" : [

        ],
        "kind" : "class",
        "properties" : [
          {
            "attributes" : [

            ],
            "hasDidSet" : false,
            "isUnowned" : false,
            "defaultValue" : "[]",
            "accessLevel" : "private",
            "isComputed" : false,
            "isWeak" : false,
            "isLazy" : false,
            "isStatic" : false,
            "hasGetter" : true,
            "isLet" : false,
            "hasSetter" : false,
            "typeName" : "[T]",
            "isFromExtension" : false,
            "hasWillSet" : false,
            "name" : "items"
          },
          {
            "attributes" : [

            ],
            "hasDidSet" : false,
            "isUnowned" : false,
            "accessLevel" : "internal",
            "isComputed" : true,
            "isWeak" : false,
            "isLazy" : false,
            "isStatic" : false,
            "hasGetter" : true,
            "isLet" : false,
            "hasSetter" : false,
            "typeName" : "T?",
            "isFromExtension" : true,
            "hasWillSet" : false,
            "name" : "max"
          }
        ],
        "typeAliases" : [

        ],
        "conformedProtocols" : [

        ],
        "initializers" : [

        ],
        "protocolRequirements" : [

        ],
        "nestedTypes" : [

        ],
        "subscripts" : [

        ],
        "inheritedTypes" : [

        ],
        "isPhantom" : false,
        "methods" : [
          {
            "isFinal" : false,
            "accessLevel" : "internal",
            "isNonMutating" : false,
            "parameters" : [
              {
                "name" : "item",
                "typeName" : "T",
                "isInout" : false,
                "attributes" : [

                ],
                "typeAttributes" : [

                ],
                "isVariadic" : false
              }
            ],
            "genericConstraints" : [

            ],
            "isMutating" : false,
            "genericParameters" : [

            ],
            "isOptional" : false,
            "throws" : false,
            "isAsync" : false,
            "isOverride" : false,
            "isStatic" : false,
            "isClass" : false,
            "returnType" : "Bool",
            "rethrows" : false,
            "isFromExtension" : true,
            "attributes" : [

            ],
            "name" : "contains"
          },
          {
            "isFinal" : false,
            "accessLevel" : "internal",
            "isNonMutating" : false,
            "parameters" : [
              {
                "name" : "item",
                "typeName" : "T",
                "isInout" : false,
                "attributes" : [

                ],
                "typeAttributes" : [

                ],
                "isVariadic" : false
              }
            ],
            "genericConstraints" : [

            ],
            "isMutating" : false,
            "genericParameters" : [

            ],
            "isOptional" : false,
            "throws" : false,
            "isAsync" : false,
            "isOverride" : false,
            "isStatic" : false,
            "isClass" : false,
            "rethrows" : false,
            "isFromExtension" : true,
            "attributes" : [

            ],
            "name" : "remove"
          },
          {
            "isFinal" : false,
            "isNonMutating" : false,
            "accessLevel" : "internal",
            "parameters" : [

            ],
            "genericConstraints" : [

            ],
            "isMutating" : false,
            "genericParameters" : [

            ],
            "throws" : false,
            "isOptional" : false,
            "isAsync" : false,
            "isOverride" : false,
            "isStatic" : false,
            "isClass" : false,
            "returnType" : "[T]",
            "rethrows" : false,
            "isFromExtension" : true,
            "attributes" : [

            ],
            "name" : "sorted"
          }
        ],
        "attributes" : [

        ],
        "name" : "Container"
      },
      "relationships" : [
        {
          "to" : "Array",
          "from" : "Container",
          "details" : "property items uses collection Array",
          "kind" : "uses"
        },
        {
          "to" : "T",
          "from" : "Container",
          "details" : "property items contains T",
          "kind" : "element_type"
        },
        {
          "to" : "T",
          "from" : "Container",
          "details" : "parameter in: contains",
          "kind" : "uses"
        },
        {
          "to" : "T",
          "from" : "Container",
          "details" : "property: items",
          "kind" : "contains"
        },
        {
          "to" : "T",
          "from" : "Container",
          "details" : "parameter in: remove",
          "kind" : "uses"
        },
        {
          "to" : "T",
          "from" : "Container",
          "details" : "property: max",
          "kind" : "contains"
        },
        {
          "to" : "T",
          "from" : "Container",
          "details" : "returns from: sorted",
          "kind" : "uses"
        }
      ]
    },
    {
      "type" : {
        "location" : {
          "file" : "<external>",
          "line" : 0,
          "column" : 0
        },
        "accessLevel" : "public",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "kind" : "class",
        "conformedProtocols" : [

        ],
        "properties" : [

        ],
        "typeAliases" : [

        ],
        "initializers" : [

        ],
        "associatedTypes" : [

        ],
        "protocolRequirements" : [

        ],
        "nestedTypes" : [

        ],
        "subscripts" : [

        ],
        "inheritedTypes" : [

        ],
        "isPhantom" : true,
        "moduleName" : "Foundation",
        "methods" : [

        ],
        "attributes" : [

        ],
        "name" : "NSObject"
      },
      "relationships" : [

      ]
    },
    {
      "type" : {
        "location" : {
          "file" : "<external>",
          "line" : 0,
          "column" : 0
        },
        "accessLevel" : "public",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "kind" : "struct",
        "conformedProtocols" : [

        ],
        "properties" : [

        ],
        "typeAliases" : [

        ],
        "initializers" : [

        ],
        "associatedTypes" : [

        ],
        "protocolRequirements" : [

        ],
        "nestedTypes" : [

        ],
        "subscripts" : [

        ],
        "inheritedTypes" : [

        ],
        "isPhantom" : true,
        "methods" : [

        ],
        "moduleName" : "Swift",
        "attributes" : [

        ],
        "name" : "Dictionary"
      },
      "relationships" : [

      ]
    },
    {
      "type" : {
        "location" : {
          "column" : 1,
          "file" : "test_extension_comprehensive.swift",
          "line" : 183
        },
        "accessLevel" : "internal",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "kind" : "class",
        "conformedProtocols" : [

        ],
        "associatedTypes" : [

        ],
        "typeAliases" : [

        ],
        "initializers" : [
          {
            "isRequired" : false,
            "genericParameters" : [

            ],
            "genericConstraints" : [

            ],
            "attributes" : [

            ],
            "parameters" : [
              {
                "typeName" : "Int",
                "label" : "rows",
                "attributes" : [

                ],
                "name" : "rows",
                "isInout" : false,
                "isVariadic" : false,
                "typeAttributes" : [

                ]
              },
              {
                "isVariadic" : false,
                "name" : "columns",
                "isInout" : false,
                "typeName" : "Int",
                "attributes" : [

                ],
                "label" : "columns",
                "typeAttributes" : [

                ]
              }
            ],
            "isFromExtension" : false,
            "accessLevel" : "internal",
            "isConvenience" : false,
            "throws" : false,
            "isFailable" : false,
            "isAsync" : false
          },
          {
            "isRequired" : false,
            "genericParameters" : [

            ],
            "genericConstraints" : [

            ],
            "attributes" : [

            ],
            "parameters" : [
              {
                "isVariadic" : false,
                "name" : "size",
                "isInout" : false,
                "typeName" : "Int",
                "attributes" : [

                ],
                "label" : "identity",
                "typeAttributes" : [

                ]
              }
            ],
            "isFromExtension" : true,
            "accessLevel" : "internal",
            "isConvenience" : true,
            "throws" : false,
            "isFailable" : false,
            "isAsync" : false
          }
        ],
        "properties" : [
          {
            "attributes" : [

            ],
            "hasDidSet" : false,
            "isUnowned" : false,
            "accessLevel" : "private",
            "isComputed" : false,
            "isWeak" : false,
            "isLazy" : false,
            "isStatic" : false,
            "hasGetter" : true,
            "isLet" : false,
            "hasSetter" : false,
            "typeName" : "[[Double]]",
            "isFromExtension" : false,
            "hasWillSet" : false,
            "name" : "data"
          },
          {
            "attributes" : [

            ],
            "hasDidSet" : false,
            "isUnowned" : false,
            "accessLevel" : "internal",
            "isComputed" : false,
            "isWeak" : false,
            "isLazy" : false,
            "isStatic" : false,
            "hasGetter" : true,
            "isLet" : true,
            "hasSetter" : false,
            "typeName" : "Int",
            "isFromExtension" : false,
            "hasWillSet" : false,
            "name" : "rows"
          },
          {
            "attributes" : [

            ],
            "hasDidSet" : false,
            "isUnowned" : false,
            "accessLevel" : "internal",
            "isComputed" : false,
            "isWeak" : false,
            "isLazy" : false,
            "isStatic" : false,
            "hasGetter" : true,
            "isLet" : true,
            "hasSetter" : false,
            "typeName" : "Int",
            "isFromExtension" : false,
            "hasWillSet" : false,
            "name" : "columns"
          }
        ],
        "protocolRequirements" : [

        ],
        "nestedTypes" : [

        ],
        "subscripts" : [
          {
            "attributes" : [

            ],
            "setterEffects" : {
              "throws" : false,
              "isMutating" : false,
              "isNonMutating" : false,
              "isAsync" : false
            },
            "hasGetter" : true,
            "accessLevel" : "internal",
            "returnType" : "Double",
            "getterEffects" : {
              "throws" : false,
              "isMutating" : false,
              "isAsync" : false,
              "isNonMutating" : false
            },
            "isStatic" : false,
            "parameters" : [
              {
                "isVariadic" : false,
                "name" : "row",
                "isInout" : false,
                "typeName" : "Int",
                "attributes" : [

                ],
                "label" : "row",
                "typeAttributes" : [

                ]
              },
              {
                "isVariadic" : false,
                "name" : "column",
                "isInout" : false,
                "typeName" : "Int",
                "attributes" : [

                ],
                "label" : "column",
                "typeAttributes" : [

                ]
              }
            ],
            "hasSetter" : true,
            "genericConstraints" : [

            ],
            "genericParameters" : [

            ]
          }
        ],
        "inheritedTypes" : [

        ],
        "isPhantom" : false,
        "methods" : [

        ],
        "attributes" : [

        ],
        "name" : "Matrix"
      },
      "relationships" : [
        {
          "to" : "[Double]",
          "details" : "property: data",
          "from" : "Matrix",
          "kind" : "contains"
        },
        {
          "to" : "Array",
          "details" : "property data uses collection Array",
          "from" : "Matrix",
          "kind" : "uses"
        }
      ]
    },
    {
      "type" : {
        "location" : {
          "file" : "<external>",
          "column" : 0,
          "line" : 0
        },
        "accessLevel" : "public",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "associatedTypes" : [

        ],
        "conformedProtocols" : [

        ],
        "properties" : [

        ],
        "typeAliases" : [

        ],
        "initializers" : [

        ],
        "kind" : "class",
        "protocolRequirements" : [

        ],
        "subscripts" : [

        ],
        "nestedTypes" : [

        ],
        "inheritedTypes" : [

        ],
        "isPhantom" : true,
        "methods" : [

        ],
        "attributes" : [

        ],
        "name" : "CodingKey"
      },
      "relationships" : [

      ]
    },
    {
      "type" : {
        "location" : {
          "file" : "test_extension_comprehensive.swift",
          "column" : 1,
          "line" : 155
        },
        "accessLevel" : "internal",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "kind" : "struct",
        "conformedProtocols" : [

        ],
        "associatedTypes" : [

        ],
        "typeAliases" : [

        ],
        "initializers" : [

        ],
        "properties" : [
          {
            "attributes" : [

            ],
            "hasDidSet" : false,
            "isUnowned" : false,
            "accessLevel" : "internal",
            "isComputed" : false,
            "isWeak" : false,
            "isLazy" : false,
            "isStatic" : false,
            "hasGetter" : true,
            "isLet" : true,
            "hasSetter" : false,
            "typeName" : "Double",
            "isFromExtension" : false,
            "hasWillSet" : false,
            "name" : "x"
          },
          {
            "attributes" : [

            ],
            "hasDidSet" : false,
            "isUnowned" : false,
            "accessLevel" : "internal",
            "isComputed" : false,
            "isWeak" : false,
            "isLazy" : false,
            "isStatic" : false,
            "hasGetter" : true,
            "isLet" : true,
            "hasSetter" : false,
            "typeName" : "Double",
            "isFromExtension" : false,
            "hasWillSet" : false,
            "name" : "y"
          },
          {
            "attributes" : [

            ],
            "hasDidSet" : false,
            "isUnowned" : false,
            "accessLevel" : "internal",
            "isComputed" : true,
            "isWeak" : false,
            "isLazy" : false,
            "isStatic" : false,
            "hasGetter" : true,
            "isLet" : false,
            "hasSetter" : false,
            "typeName" : "Double",
            "isFromExtension" : true,
            "hasWillSet" : false,
            "name" : "magnitude"
          },
          {
            "attributes" : [

            ],
            "hasDidSet" : false,
            "isUnowned" : false,
            "accessLevel" : "internal",
            "isComputed" : true,
            "isWeak" : false,
            "isLazy" : false,
            "isStatic" : false,
            "hasGetter" : true,
            "isLet" : false,
            "hasSetter" : false,
            "typeName" : "Double",
            "isFromExtension" : true,
            "hasWillSet" : false,
            "name" : "angle"
          }
        ],
        "protocolRequirements" : [

        ],
        "subscripts" : [

        ],
        "nestedTypes" : [

        ],
        "inheritedTypes" : [

        ],
        "isPhantom" : false,
        "methods" : [
          {
            "isFinal" : false,
            "accessLevel" : "internal",
            "isNonMutating" : false,
            "parameters" : [
              {
                "name" : "other",
                "typeAttributes" : [

                ],
                "isVariadic" : false,
                "isInout" : false,
                "typeName" : "Point",
                "label" : "to",
                "attributes" : [

                ]
              }
            ],
            "genericConstraints" : [

            ],
            "isMutating" : false,
            "genericParameters" : [

            ],
            "isOptional" : false,
            "throws" : false,
            "isAsync" : false,
            "isOverride" : false,
            "isStatic" : false,
            "isClass" : false,
            "returnType" : "Double",
            "rethrows" : false,
            "isFromExtension" : true,
            "attributes" : [

            ],
            "name" : "distance"
          },
          {
            "isFinal" : false,
            "accessLevel" : "internal",
            "isNonMutating" : false,
            "parameters" : [
              {
                "typeAttributes" : [

                ],
                "name" : "factor",
                "label" : "by",
                "attributes" : [

                ],
                "typeName" : "Double",
                "isVariadic" : false,
                "isInout" : false
              }
            ],
            "genericConstraints" : [

            ],
            "isMutating" : false,
            "genericParameters" : [

            ],
            "throws" : false,
            "isOptional" : false,
            "isAsync" : false,
            "isOverride" : false,
            "isStatic" : false,
            "isClass" : false,
            "returnType" : "Point",
            "rethrows" : false,
            "isFromExtension" : true,
            "attributes" : [

            ],
            "name" : "scaled"
          }
        ],
        "attributes" : [

        ],
        "name" : "Point"
      },
      "relationships" : [
        {
          "to" : "Point",
          "from" : "Point",
          "kind" : "uses",
          "details" : "returns from: scaled"
        },
        {
          "to" : "Point",
          "from" : "Point",
          "kind" : "uses",
          "details" : "parameter in: distance"
        }
      ]
    },
    {
      "type" : {
        "location" : {
          "line" : 214,
          "file" : "test_extension_comprehensive.swift",
          "column" : 1
        },
        "accessLevel" : "internal",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "associatedTypes" : [

        ],
        "kind" : "class",
        "properties" : [
          {
            "attributes" : [

            ],
            "hasDidSet" : false,
            "isUnowned" : false,
            "accessLevel" : "internal",
            "isComputed" : true,
            "isWeak" : false,
            "isLazy" : false,
            "isStatic" : false,
            "hasGetter" : true,
            "isLet" : false,
            "hasSetter" : false,
            "typeName" : "Int",
            "isFromExtension" : true,
            "hasWillSet" : false,
            "name" : "extensionProperty"
          }
        ],
        "typeAliases" : [

        ],
        "conformedProtocols" : [

        ],
        "initializers" : [

        ],
        "protocolRequirements" : [

        ],
        "nestedTypes" : [

        ],
        "subscripts" : [

        ],
        "inheritedTypes" : [

        ],
        "isPhantom" : false,
        "methods" : [
          {
            "isFinal" : false,
            "accessLevel" : "internal",
            "isNonMutating" : false,
            "parameters" : [

            ],
            "genericConstraints" : [

            ],
            "isMutating" : false,
            "genericParameters" : [

            ],
            "isOptional" : false,
            "throws" : false,
            "isAsync" : false,
            "isOverride" : false,
            "isClass" : false,
            "isStatic" : false,
            "returnType" : "String",
            "rethrows" : false,
            "isFromExtension" : true,
            "attributes" : [

            ],
            "name" : "extensionMethod"
          }
        ],
        "attributes" : [

        ],
        "name" : "UnknownClass"
      },
      "relationships" : [

      ]
    },
    {
      "type" : {
        "location" : {
          "column" : 0,
          "file" : "<external>",
          "line" : 0
        },
        "accessLevel" : "public",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "kind" : "class",
        "conformedProtocols" : [

        ],
        "properties" : [

        ],
        "typeAliases" : [

        ],
        "initializers" : [

        ],
        "associatedTypes" : [

        ],
        "protocolRequirements" : [

        ],
        "nestedTypes" : [

        ],
        "subscripts" : [

        ],
        "inheritedTypes" : [

        ],
        "isPhantom" : true,
        "methods" : [

        ],
        "moduleName" : "UIKit",
        "attributes" : [

        ],
        "name" : "UIViewController"
      },
      "relationships" : [
        {
          "details" : "framework inheritance chain",
          "kind" : "inherits",
          "from" : "UIViewController",
          "to" : "UIResponder"
        }
      ]
    },
    {
      "type" : {
        "location" : {
          "column" : 0,
          "line" : 0,
          "file" : "<external>"
        },
        "accessLevel" : "public",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "kind" : "protocol",
        "conformedProtocols" : [

        ],
        "properties" : [

        ],
        "typeAliases" : [

        ],
        "initializers" : [

        ],
        "associatedTypes" : [

        ],
        "protocolRequirements" : [

        ],
        "nestedTypes" : [

        ],
        "subscripts" : [

        ],
        "inheritedTypes" : [

        ],
        "isPhantom" : true,
        "methods" : [

        ],
        "moduleName" : "Swift",
        "attributes" : [

        ],
        "name" : "Hashable"
      },
      "relationships" : [

      ]
    },
    {
      "type" : {
        "location" : {
          "column" : 0,
          "file" : "<external>",
          "line" : 0
        },
        "accessLevel" : "public",
        "genericConstraints" : [

        ],
        "genericParameters" : [

        ],
        "kind" : "class",
        "conformedProtocols" : [

        ],
        "properties" : [

        ],
        "typeAliases" : [

        ],
        "initializers" : [

        ],
        "associatedTypes" : [

        ],
        "protocolRequirements" : [

        ],
        "subscripts" : [

        ],
        "nestedTypes" : [

        ],
        "inheritedTypes" : [

        ],
        "isPhantom" : true,
        "moduleName" : "UIKit",
        "methods" : [

        ],
        "attributes" : [

        ],
        "name" : "UIResponder"
      },
      "relationships" : [
        {
          "details" : "framework inheritance chain",
          "kind" : "inherits",
          "to" : "NSObject",
          "from" : "UIResponder"
        }
      ]
    }
  ]
};
        class SwiftDiagramVisualization {
    constructor(data) {
        this.data = data;
        this.svg = d3.select('#diagram');
        this.container = this.svg.append('g');
        this.selectedNode = null;
        this.simulation = null;
        this.currentTheme = 'light';
        
        this.zoom = d3.zoom()
            .scaleExtent([0.1, 3])
            .on('zoom', this.handleZoom.bind(this));
        
        this.svg.call(this.zoom);
        this.setupEventListeners();
        this.setupDefinitions();
        this.render();
    }
    
    setupEventListeners() {
        d3.select('#reset-zoom').on('click', () => this.resetZoom());
        d3.select('#toggle-theme').on('click', () => this.toggleTheme());
        
        // Original search input (keep for sidebar functionality)
        d3.select('#search-input').on('input', (e) => this.handleSearch(e.target.value));
        
        // New diagram search input
        d3.select('#diagram-search-input').on('input', (e) => this.handleDiagramSearch(e.target.value));
        d3.select('#diagram-search-input').on('focus', () => this.showSearchResults());
        d3.select('#diagram-search-input').on('blur', () => {
            // Delay hiding to allow clicking on results
            setTimeout(() => this.hideSearchResults(), 150);
        });
        
        d3.select('#show-properties').on('change', () => this.render());
        d3.select('#show-methods').on('change', () => this.render());
        d3.select('#show-initializers').on('change', () => this.render());
        d3.select('#show-private').on('change', () => this.render());
        
        // Close search results when clicking outside
        d3.select('body').on('click', (event) => {
            if (!event.target.closest('.diagram-search-bar')) {
                this.hideSearchResults();
            }
        });
        
        // Keyboard shortcuts
        d3.select('body').on('keydown', (event) => {
            if (event.ctrlKey || event.metaKey) {
                switch(event.key) {
                    case '0':
                        event.preventDefault();
                        this.resetZoom();
                        break;
                    case 'f':
                        event.preventDefault();
                        d3.select('#diagram-search-input').node().focus();
                        break;
                }
            }
            
            // ESC to close search results
            if (event.key === 'Escape') {
                this.hideSearchResults();
                d3.select('#diagram-search-input').node().blur();
            }
        });
    }
    
    setupDefinitions() {
        const defs = this.container.append('defs');
        
        // Arrow markers for different relationship types
        const arrowTypes = [
            { id: 'inheritance', color: '#3498db' },
            { id: 'conformance', color: '#9b59b6' },
            { id: 'composition', color: '#e74c3c' },
            { id: 'dependency', color: '#95a5a6' }
        ];
        
        arrowTypes.forEach(type => {
            defs.append('marker')
                .attr('id', `arrowhead-${type.id}`)
                .attr('viewBox', '0 -5 10 10')
                .attr('refX', 15)
                .attr('refY', 0)
                .attr('markerWidth', 6)
                .attr('markerHeight', 6)
                .attr('orient', 'auto')
                .append('path')
                .attr('d', 'M0,-5L10,0L0,5')
                .attr('fill', type.color);
        });
    }
    
    handleZoom(event) {
        this.container.attr('transform', event.transform);
    }
    
    resetZoom() {
        this.svg.transition()
            .duration(750)
            .call(this.zoom.transform, d3.zoomIdentity);
    }
    
    toggleTheme() {
        this.currentTheme = this.currentTheme === 'light' ? 'dark' : 'light';
        document.documentElement.className = this.currentTheme + '-theme';
    }
    
    handleSearch(query) {
        const filtered = this.data.nodes.filter(node => 
            node.type.name.toLowerCase().includes(query.toLowerCase()) ||
            node.type.kind.toLowerCase().includes(query.toLowerCase())
        );
        this.updateTypeList(filtered);
        
        // Highlight matching nodes in the diagram
        this.container.selectAll('.node')
            .classed('search-highlight', d => 
                query && filtered.some(f => f.type.name === d.type.name)
            );
    }
    
    handleDiagramSearch(query) {
        if (!query.trim()) {
            this.hideSearchResults();
            // Remove all highlighting
            this.container.selectAll('.node').classed('search-highlight', false);
            return;
        }
        
        const filtered = this.data.nodes.filter(node => 
            node.type.name.toLowerCase().includes(query.toLowerCase()) ||
            node.type.kind.toLowerCase().includes(query.toLowerCase()) ||
            (node.type.properties && node.type.properties.some(prop => 
                prop.name.toLowerCase().includes(query.toLowerCase())
            )) ||
            (node.type.methods && node.type.methods.some(method => 
                method.name.toLowerCase().includes(query.toLowerCase())
            ))
        );
        
        this.displaySearchResults(filtered, query);
        
        // Highlight matching nodes in the diagram
        this.container.selectAll('.node')
            .classed('search-highlight', d => 
                filtered.some(f => f.type.name === d.type.name)
            );
    }
    
    displaySearchResults(results, query) {
        const searchResults = d3.select('#search-results');
        
        if (results.length === 0) {
            searchResults.html('<div class="search-result-item"><div class="search-result-description">No results found</div></div>');
            this.showSearchResults();
            return;
        }
        
        const items = searchResults.selectAll('.search-result-item')
            .data(results.slice(0, 10), d => d.type.name); // Show max 10 results
        
        items.exit().remove();
        
        const itemsEnter = items.enter()
            .append('div')
            .attr('class', 'search-result-item')
            .on('click', (event, d) => this.focusOnNode(d));
        
        const itemsUpdate = itemsEnter.merge(items);
        
        itemsUpdate.html(d => {
            const matchingProps = d.type.properties ? d.type.properties.filter(prop => 
                prop.name.toLowerCase().includes(query.toLowerCase())
            ).slice(0, 3) : [];
            
            const matchingMethods = d.type.methods ? d.type.methods.filter(method => 
                method.name.toLowerCase().includes(query.toLowerCase())
            ).slice(0, 3) : [];
            
            let description = '';
            if (matchingProps.length > 0) {
                description += 'Properties: ' + matchingProps.map(p => p.name).join(', ');
            }
            if (matchingMethods.length > 0) {
                if (description) description += '  ';
                description += 'Methods: ' + matchingMethods.map(m => m.name).join(', ');
            }
            
            return `
                <div class="search-result-type">\${d.type.name}</div>
                <div class="search-result-kind">\${d.type.kind}</div>
                \${description ? `<div class="search-result-description">\${description}</div>` : ''}
            `;
        });
        
        this.showSearchResults();
    }
    
    showSearchResults() {
        d3.select('#search-results').classed('active', true);
    }
    
    hideSearchResults() {
        d3.select('#search-results').classed('active', false);
    }
    
    focusOnNode(nodeData) {
        // Find the node in the diagram and zoom to it
        const node = this.container.select(`.node[data-name="\${nodeData.type.name}"]`).node();
        if (node) {
            const bbox = node.getBBox();
            const centerX = bbox.x + bbox.width / 2;
            const centerY = bbox.y + bbox.height / 2;
            
            // Calculate transform to center the node
            const svg = d3.select('#diagram');
            const svgRect = svg.node().getBoundingClientRect();
            const scale = 1.5;
            const translateX = svgRect.width / 2 - centerX * scale;
            const translateY = svgRect.height / 2 - centerY * scale;
            
            // Apply zoom transform
            svg.transition()
                .duration(750)
                .call(this.zoom.transform, d3.zoomIdentity.translate(translateX, translateY).scale(scale));
            
            // Temporarily highlight the focused node
            d3.select(node).classed('focused-node', true);
            setTimeout(() => {
                d3.select(node).classed('focused-node', false);
            }, 2000);
        }
        
        this.hideSearchResults();
    }
    
    getNodeColor(kind) {
        const colors = {
            'class': 'var(--node-class)',
            'struct': 'var(--node-struct)',
            'protocol': 'var(--node-protocol)',
            'enum': 'var(--node-enum)',
            'actor': 'var(--node-actor)'
        };
        return colors[kind] || 'var(--node-class)';
    }
    
    getRelationshipColor(kind) {
        const colors = {
            'inherits': '#3498db',
            'conforms': '#9b59b6',
            'contains': '#e74c3c',
            'uses': '#95a5a6'
        };
        return colors[kind] || '#95a5a6';
    }
    
    render() {
        const showProperties = d3.select('#show-properties').property('checked');
        const showMethods = d3.select('#show-methods').property('checked');
        const showInitializers = d3.select('#show-initializers').property('checked');
        const showPrivate = d3.select('#show-private').property('checked');
        
        let filteredNodes = this.data.nodes;
        if (!showPrivate) {
            filteredNodes = filteredNodes.filter(node => node.type.accessLevel !== 'private');
        }
        
        this.renderDiagram(filteredNodes, showProperties, showMethods, showInitializers);
        this.updateTypeList(filteredNodes);
    }
    
    renderDiagram(nodes, showProperties, showMethods, showInitializers) {
        const links = [];
        // Extract relationships from nodes
        nodes.forEach(node => {
            node.relationships.forEach(rel => {
                if (nodes.find(n => n.type.name === rel.to)) {
                    links.push({
                        source: node.type.name,
                        target: rel.to,
                        kind: rel.kind
                    });
                }
            });
        });
        
        // Clear existing content
        this.container.selectAll('.diagram-content').remove();
        const diagramGroup = this.container.append('g').attr('class', 'diagram-content');
        
        // Create simulation with enhanced forces
        this.simulation = d3.forceSimulation(nodes)
            .force('link', d3.forceLink(links).id(d => d.type.name).distance(150).strength(0.1))
            .force('charge', d3.forceManyBody().strength(-800))
            .force('center', d3.forceCenter(400, 300))
            .force('collision', d3.forceCollide().radius(80))
            .force('x', d3.forceX(400).strength(0.05))
            .force('y', d3.forceY(300).strength(0.05));
        
        // Create links
        const link = diagramGroup.append('g')
            .attr('class', 'links')
            .selectAll('line')
            .data(links)
            .join('line')
            .attr('class', d => `link ${d.kind}`)
            .attr('stroke', d => this.getRelationshipColor(d.kind))
            .attr('stroke-width', d => d.kind === 'contains' ? 3 : 2);
        
        // Create nodes
        const node = diagramGroup.append('g')
            .attr('class', 'nodes')
            .selectAll('g')
            .data(nodes)
            .join('g')
            .attr('class', 'node-group')
            .call(d3.drag()
                .on('start', this.handleDragStart.bind(this))
                .on('drag', this.handleDrag.bind(this))
                .on('end', this.handleDragEnd.bind(this)));
        
        // Add rectangles for nodes
        node.append('rect')
            .attr('class', 'node')
            .attr('data-name', d => d.type.name)
            .attr('width', d => this.getNodeWidth(d, showProperties, showMethods, showInitializers))
            .attr('height', d => this.getNodeHeight(d, showProperties, showMethods, showInitializers))
            .attr('rx', 8)
            .attr('ry', 8)
            .attr('fill', d => this.getNodeColor(d.type.kind))
            .on('click', (event, d) => this.selectNode(d));
        
        // Add node content
        this.addNodeContent(node, showProperties, showMethods, showInitializers);
        
        // Update simulation
        this.simulation.on('tick', () => {
            link
                .attr('x1', d => d.source.x + this.getNodeWidth(d.source, showProperties, showMethods, showInitializers) / 2)
                .attr('y1', d => d.source.y + this.getNodeHeight(d.source, showProperties, showMethods, showInitializers) / 2)
                .attr('x2', d => d.target.x + this.getNodeWidth(d.target, showProperties, showMethods, showInitializers) / 2)
                .attr('y2', d => d.target.y + this.getNodeHeight(d.target, showProperties, showMethods, showInitializers) / 2);
            
            node.attr('transform', d => `translate(${d.x},${d.y})`);
        });
    }
    
    getNodeWidth(node, showProperties, showMethods, showInitializers) {
        let width = 180;
        if (showProperties && node.type.properties?.length > 0) width += 20;
        if (showMethods && node.type.methods?.length > 0) width += 20;
        if (showInitializers && node.type.initializers?.length > 0) width += 20;
        return Math.max(width, node.type.name.length * 8 + 40);
    }
    
    getNodeHeight(node, showProperties, showMethods, showInitializers) {
        let height = 60;
        if (showProperties && node.type.properties?.length > 0) {
            height += Math.min(node.type.properties.length * 15, 80);
        }
        if (showMethods && node.type.methods?.length > 0) {
            height += Math.min(node.type.methods.length * 15, 80);
        }
        if (showInitializers && node.type.initializers?.length > 0) {
            height += Math.min(node.type.initializers.length * 15, 80);
        }
        return height;
    }
    
    addNodeContent(nodeSelection, showProperties, showMethods, showInitializers) {
        // Add title
        nodeSelection.append('text')
            .attr('class', 'node-text node-title')
            .attr('x', d => this.getNodeWidth(d, showProperties, showMethods, showInitializers) / 2)
            .attr('y', 20)
            .text(d => d.type.name);
        
        // Add type indicator
        nodeSelection.append('text')
            .attr('class', 'node-text node-type')
            .attr('x', d => this.getNodeWidth(d, showProperties, showMethods, showInitializers) / 2)
            .attr('y', 35)
            .text(d => `<<${d.type.kind}>>`);
        
        // Add details
        nodeSelection.append('text')
            .attr('class', 'node-text node-details')
            .attr('x', d => this.getNodeWidth(d, showProperties, showMethods, showInitializers) / 2)
            .attr('y', 50)
            .text(d => {
                const propCount = d.type.properties?.length || 0;
                const methodCount = d.type.methods?.length || 0;
                const initCount = d.type.initializers?.length || 0;
                return `${propCount}p, ${methodCount}m, ${initCount}i`;
            });
    }
    
    handleDragStart(event, d) {
        if (!event.active) this.simulation.alphaTarget(0.3).restart();
        d.fx = d.x;
        d.fy = d.y;
    }
    
    handleDrag(event, d) {
        d.fx = event.x;
        d.fy = event.y;
    }
    
    handleDragEnd(event, d) {
        if (!event.active) this.simulation.alphaTarget(0);
        d.fx = null;
        d.fy = null;
    }
    
    selectNode(node) {
        this.selectedNode = node;
        d3.selectAll('.node').classed('selected', false);
        d3.selectAll('.node').filter(d => d.type.name === node.type.name).classed('selected', true);
        this.showTypeDetails(node);
    }
    
    updateTypeList(nodes) {
        const typeList = d3.select('#type-list');
        const items = typeList.selectAll('.type-item')
            .data(nodes, d => d.type.name);
        
        const itemsEnter = items.enter()
            .append('div')
            .attr('class', 'type-item');
        
        itemsEnter.append('div')
            .attr('class', 'type-item-name');
        
        itemsEnter.append('div')
            .attr('class', 'type-item-kind');
        
        const itemsUpdate = itemsEnter.merge(items);
        
        itemsUpdate.select('.type-item-name')
            .text(d => d.type.name);
        
        itemsUpdate.select('.type-item-kind')
            .text(d => d.type.kind);
        
        itemsUpdate.on('click', (event, d) => this.selectNode(d));
        
        items.exit().remove();
    }
    
    showTypeDetails(node) {
        const details = d3.select('#type-details');
        details.html('');
        
        const container = details.append('div').attr('class', 'type-details');
        
        container.append('h4').text(node.type.name);
        
        container.append('div')
            .attr('class', `access-level ${node.type.accessLevel}`)
            .text(node.type.accessLevel);
        
        container.append('p').text(`Type: ${node.type.kind}`);
        
        if (node.type.conformedProtocols?.length > 0) {
            container.append('h5').text('Conforms to:');
            const list = container.append('ul');
            node.type.conformedProtocols.forEach(protocol => {
                list.append('li').text(protocol);
            });
        }
        
        if (node.type.initializers?.length > 0) {
            container.append('h5').text('Initializers:');
            const list = container.append('ul');
            node.type.initializers.forEach(init => {
                const params = init.parameters?.map(p => `${p.name}: ${p.typeName}`).join(', ') || '';
                const signature = `init(${params})`;
                list.append('li').text(signature);
            });
        }
        
        if (node.type.properties?.length > 0) {
            container.append('h5').text('Properties:');
            const list = container.append('ul');
            node.type.properties.forEach(prop => {
                const propType = prop.isLet ? 'let' : 'var';
                const propText = `${propType} ${prop.name}: ${prop.typeName}`;
                list.append('li').text(propText);
            });
        }
        
        if (node.type.methods?.length > 0) {
            container.append('h5').text('Methods:');
            const list = container.append('ul');
            node.type.methods.forEach(method => {
                const params = method.parameters?.map(p => `${p.name}: ${p.typeName}`).join(', ') || '';
                const returnType = method.returnType ? ` -> ${method.returnType}` : '';
                const signature = `${method.name}(${params})${returnType}`;
                list.append('li').text(signature);
            });
        }
    }
}

// Initialize visualization when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
    if (typeof graphData !== 'undefined') {
        new SwiftDiagramVisualization(graphData);
    } else {
        console.error('Graph data not found');
    }
});
    </script>
</body>
</html>